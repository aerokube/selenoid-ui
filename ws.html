<html>
<head>
    <title>Camel Twitter WebSocket Example</title>
    <script type='text/javascript'>
        if (!window.WebSocket) {
            alert("WebSocket not supported by this browser");
        }
        function $() { return document.getElementById(arguments[0]); }
        var room = {
            join: function(name) {
                this._username=name;
                var location = "ws://localhost:4444/logs/b6a10598-998a-46e8-81cd-9511cad05f9a";
                this._ws=new WebSocket(location);
                this._ws.binaryType = 'arraybuffer';
                this._ws.onmessage=this._onmessage;
                this._ws.onclose=this._onclose;
            },
            _onmessage: function(m) {

                ABToStr = ab =>
                    new Uint8Array(ab, 8).reduce((p, c) =>
                    p + String.fromCharCode(c), '');

                if (m){
                    var msg = ABToStr(m.data);

                    var chat=$('chat');
                    var spanText = document.createElement('span');
                    spanText.className='text';
                    spanText.innerHTML=msg;
                    var lineBreak = document.createElement('br');
                    chat.appendChild(spanText);
                    chat.appendChild(lineBreak);
                    chat.scrollTop = chat.scrollHeight - chat.clientHeight;
                }
            },
            _onclose: function(m) {
                this._ws=null;
            }
        };
    </script>
    <style type='text/css'>
        div { border: 0px solid black; }
        div#chat { clear: both; width: 80em; height: 60ex; overflow: auto; background-color: #f0f0f0; padding: 4px; border: 1px solid black; }
    </style>
</head>
<body>
<div id='chat'></div>
<script type='text/javascript'>
    room.join("Testing");
</script>
</body>
</html>
